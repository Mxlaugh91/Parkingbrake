## 2024-05-24 - Trusting the Client with Vehicle Class

**Vulnerability:** The server event `qbx_parkingbrake:server:toggle` was missing a server-side check against `Config.ExcludedClasses` before applying the parking brake, trusting the client-side check to prevent unsupported vehicles (like helicopters) from using the feature. This allowed malicious clients to bypass the check and trigger the event manually via native calls. The event also used `RegisterNetEvent` instead of a more secure `lib.callback`.
**Learning:** In FiveM, clients can easily trigger networked events manually, bypassing any client-side validation logic. The server must never trust the client's state validation and must independently verify all constraints (like vehicle class) before performing actions that affect global entity states. Furthermore, using `lib.callback` for client-to-server operations is preferred over `TriggerServerEvent`/`RegisterNetEvent` as it provides better security patterns against automated triggering.
**Prevention:** Always implement duplicate server-side validation for any constraints checked on the client before executing sensitive logic. Migrate from `RegisterNetEvent` to `lib.callback.register` (ox_lib) for explicit client requests to ensure a more controlled and secure data flow.
